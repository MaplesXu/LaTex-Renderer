<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0, user-scalable=yes">
    <title>LaTeXÂ·PDFæ¸²æŸ“å™¨</title>
    <!-- MathJax ç¨³å®šåŒæº (BootCDN + jsDelivrå¤‡é€‰) -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$','$'],['\\(','\\)']], displayMath: [['$$','$$'],['\\[','\\]']], processEscapes: true },
            options: { skipHtmlTags: ['script','noscript','style','textarea','pre','code'] },
            loader: { load: ['[tex]/noerrors'] }
        };
    </script>
    <script src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.js" id="MathJax-script" async></script>
    <script>
        setTimeout(() => {
            if (typeof MathJax === 'undefined' || !MathJax.tex) {
                let s = document.createElement('script');
                s.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js';
                document.head.appendChild(s);
            }
        }, 2000);
    </script>
    <style>
        /* å…¨å±€ç´§å‡‘è°ƒå° â€”â€” æ‰‹æœº/æ¡Œé¢çš†å®œ */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            background: #e2ecf0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 16px;
        }
        .app {
            max-width: 950px;
            width: 100%;
            background: white;
            border-radius: 24px;
            box-shadow: 0 16px 30px -10px #1b4a5a30;
            padding: 24px 28px;
            border: 1px solid #d0e2ea;
        }
        h1 {
            font-size: 1.6rem;
            font-weight: 550;
            color: #0b4452;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }
        h1 span {
            background: #1f6573;
            color: white;
            font-size: 0.7rem;
            padding: 4px 14px;
            border-radius: 30px;
        }
        .sub {
            font-size: 0.85rem;
            color: #256575;
            background: #ecf7fb;
            padding: 10px 18px;
            border-radius: 20px;
            border-left: 5px solid #3897ad;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        .input-box {
            background: #f6fcff;
            border-radius: 20px;
            padding: 18px;
            border: 1px solid #cfe1e9;
            margin-bottom: 16px;
        }
        .input-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            font-weight: 600;
            color: #0e5563;
            margin-bottom: 10px;
        }
        textarea {
            width: 100%;
            padding: 16px 18px;
            border: 1px solid #bfd7e2;
            border-radius: 18px;
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            background: white;
            resize: vertical;
        }
        textarea:focus {
            border-color: #318ca0;
            outline: none;
            box-shadow: 0 0 0 2px #318ca030;
        }
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 16px;
            margin: 12px 0 8px;
        }
        .btn {
            border: none;
            background: #1d6d7c;
            color: white;
            padding: 10px 26px;
            border-radius: 36px;
            font-weight: 600;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            border: 1px solid #ffffff80;
            box-shadow: 0 6px 12px -8px #0c4a55;
            transition: 0.1s;
        }
        .btn:hover {
            background: #2a889b;
            transform: scale(0.97);
        }
        .btn-outline {
            background: white;
            color: #1a6b78;
            border: 1px solid #3993a8;
            box-shadow: none;
        }
        .btn-outline:hover {
            background: #ecf8fc;
        }
        .render-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 22px 0 10px;
        }
        .render-title {
            font-weight: 600;
            color: #0a5a67;
            font-size: 1rem;
        }
        .render-area {
            background: #faffff;
            border-radius: 20px;
            padding: 24px 28px;
            border: 1px solid #c0dbe6;
            box-shadow: inset 0 1px 4px #00000008;
            overflow-x: auto;
            font-size: 1.2rem;
            line-height: 2.0;
            min-height: 150px;
            transition: all 0.2s;
        }
        /* å…¨å±é˜…è¯»ï¼šå­—ä½“1.1rem æ›´èˆ’é€‚ */
        .render-area:-webkit-full-screen {
            background: #f5fcff;
            padding: 40px;
            font-size: 1.1rem;
        }
        .render-area:fullscreen {
            background: #f5fcff;
            padding: 40px;
            font-size: 1.1rem;
        }
        .status-line {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            margin-top: 14px;
            font-size: 0.75rem;
            color: #307180;
            gap: 18px;
        }
        .badge {
            background: #e2f0f5;
            padding: 4px 14px;
            border-radius: 30px;
        }
        hr {
            border: 0.5px solid #cde3ec;
            margin: 16px 0 8px;
        }
        /* æ‰“å°æ ·å¼ä¼˜åŒ– */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .app {
                box-shadow: none;
                border: none;
                padding: 0;
                margin: 0;
                max-width: 100%;
            }
            .input-box, .toolbar, .render-header, .status-line, hr, .sub, h1 span, .btn, .btn-outline {
                display: none !important;
            }
            .render-area {
                border: none;
                box-shadow: none;
                padding: 0.5in;
                font-size: 12pt;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <h1>
            ğŸ“ LaTeXÂ·çº¯å‡€æ¸²æŸ“
            <span>PDFç›´å‡º</span>
        </h1>
        

        <!-- è¾“å…¥åŒºï¼šç²˜è´´æ ‡å‡†LaTeXæºç  -->
        <div class="input-box">
            <div class="input-header">
                <span>ğŸ“‹ LaTeX æºç </span>
                <span style="color:#1d7585;">æ”¯æŒLaTexæ¸²æŸ“+PDFå¯¼å‡º</span>
            </div>
            <textarea id="latexInput" rows="5"></textarea>
        </div>

        <!-- å·¥å…·æ¡ï¼šæ¸²æŸ“ + å…¨å± + PDFå¯¼å‡ºï¼ˆæ— docxæ®‹ç•™ï¼‰ -->
        <div class="toolbar">
            <button class="btn" id="renderBtn">
                âš¡ æ¸²æŸ“å…¬å¼
            </button>
            <button class="btn btn-outline" id="fullscreenBtn">
                ğŸ“º å…¨å±é˜…è¯»
            </button>
            <button class="btn btn-outline" id="pdfBtn">
                ğŸ“„ ç”ŸæˆPDF
            </button>
        </div>

        <!-- æ¸²æŸ“å®¹å™¨â€”â€”æ‰€æœ‰å…¬å¼åœ¨æ­¤æ˜¾ç¤º -->
        <div class="render-header">
            <span class="render-title">âœ¨ æ¸²æŸ“ç»“æœ</span>
        </div>
        <div id="mathContainer" class="render-area">
            
        </div>

        <hr>
        <div class="status-line">
            <span class="badge">ğŸ§ª çº¯æ¸²æŸ“Â·0è½¬æ¢</span>
            <span class="badge">ğŸŒ MathJax BootCDN+å¤‡é€‰</span>
            <span class="badge">ğŸ“„ PDFç”ŸæˆåŸºäºæµè§ˆå™¨æ‰“å°</span>
        </div>
    </div>

    <script>
        (function(){
            "use strict";

            const inputEl = document.getElementById('latexInput');
            const container = document.getElementById('mathContainer');
            const renderBtn = document.getElementById('renderBtn');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const pdfBtn = document.getElementById('pdfBtn');

            // ---------- æ¸²æŸ“æ ¸å¿ƒï¼šåŸæ ·ä¿ç•™LaTeXå®šç•Œç¬¦ ----------
            function render() {
                const source = inputEl.value;
                if (!source.trim()) return;

                let lines = source.split('\n');
                let html = '';
                lines.forEach(line => {
                    let trimmed = line.trim();
                    if (trimmed === '') {
                        html += '<br>';
                    } else {
                        // ä¿ç•™åŸå§‹å®šç•Œç¬¦ï¼ŒåªåšHTMLè½¬ä¹‰ï¼ˆé˜²æ­¢XSSï¼‰
                        html += `<p style="margin:0.6rem 0;">${escapeHtml(line)}</p>`;
                    }
                });
                container.innerHTML = html;

                // è§¦å‘MathJaxé‡æ–°æ¸²æŸ“
                if (window.MathJax && typeof MathJax.texReset === 'function') {
                    MathJax.texReset();
                    MathJax.typesetPromise([container]).catch(e => {
                        console.warn('MathJaxæ¸²æŸ“å¼‚å¸¸', e);
                        container.innerHTML += '<p style="color:#b34a4a;">âš ï¸ å…¬å¼è¯­æ³•é”™è¯¯ï¼Œè¯·æ£€æŸ¥</p>';
                    });
                } else {
                    let retry = 0;
                    let timer = setInterval(() => {
                        if (window.MathJax && MathJax.texReset) {
                            clearInterval(timer);
                            MathJax.texReset();
                            MathJax.typesetPromise([container]).catch(console.warn);
                        }
                        if (++retry > 30) clearInterval(timer);
                    }, 100);
                }
            }

            function escapeHtml(unsafe) {
                return unsafe.replace(/&/g, '&amp;')
                             .replace(/</g, '&lt;')
                             .replace(/>/g, '&gt;')
                             .replace(/"/g, '&quot;')
                             .replace(/'/g, '&#039;');
            }

            // ---------- å…¨å±é˜…è¯» (å­—ä½“å·²ç”±CSSè°ƒè‡³1.1rem) ----------
            function toggleFullScreen() {
                if (!document.fullscreenElement) {
                    container.requestFullscreen().catch(err => {
                        alert(`å…¨å±å¤±è´¥: ${err.message}`);
                    });
                } else {
                    document.exitFullscreen();
                }
            }

            // ---------- PDFå¯¼å‡ºç»ˆææ–¹æ¡ˆï¼šæµè§ˆå™¨åŸç”Ÿæ‰“å° ----------
            function exportPDF() {
                // ä¿å­˜å½“å‰æ¸²æŸ“å†…å®¹
                const content = container.innerHTML;
                
                // åˆ›å»ºéšè—çš„æ‰“å°iframe
                const printFrame = document.createElement('iframe');
                printFrame.style.position = 'fixed';
                printFrame.style.top = '-9999px';
                printFrame.style.left = '-9999px';
                printFrame.style.width = '0';
                printFrame.style.height = '0';
                printFrame.style.border = 'none';
                document.body.appendChild(printFrame);
                
                const doc = printFrame.contentWindow.document;
                doc.open();
                doc.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>LaTeXå…¬å¼å¯¼å‡ºPDF</title>
                        <!-- é‡æ–°åŠ è½½MathJaxï¼Œä¿è¯å…¬å¼å®Œç¾æ˜¾ç¤º -->
                        <script src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.js" async><\/script>
                        <style>
                            body {
                                font-family: 'Times New Roman', 'STIX Two Math', serif;
                                font-size: 14pt;
                                margin: 2cm;
                                line-height: 1.8;
                                background: white;
                                color: black;
                            }
                            mjx-container {
                                display: inline-block;
                                margin: 0.15em 0;
                                white-space: nowrap;
                            }
                            p {
                                margin: 0.8em 0;
                            }
                            @media print {
                                body { margin: 1.8cm; }
                            }
                        </style>
                    </head>
                    <body>
                        ${content}
                        <p style="text-align: center; margin-top: 1.5cm; color: gray; font-size: 10pt;">
                            â€” ç”± LaTeXÂ·çº¯å‡€æ¸²æŸ“å™¨ ç”Ÿæˆ â€”
                        </p>
                    </body>
                    </html>
                `);
                doc.close();

                // ç­‰å¾…MathJaxæ¸²æŸ“å®Œæˆåè°ƒå‡ºæ‰“å°å¯¹è¯æ¡†
                setTimeout(() => {
                    printFrame.contentWindow.focus();
                    printFrame.contentWindow.print();
                    
                    // æ‰“å°å¯¹è¯æ¡†å…³é—­åç§»é™¤iframe
                    setTimeout(() => {
                        document.body.removeChild(printFrame);
                    }, 500);
                }, 800); // ç»™MathJaxç•™è¶³æ¸²æŸ“æ—¶é—´
            }

            // ---------- äº‹ä»¶ç»‘å®š ----------
            renderBtn.addEventListener('click', render);
            fullscreenBtn.addEventListener('click', toggleFullScreen);
            pdfBtn.addEventListener('click', exportPDF);

            // å¿«æ·é”® Ctrl+Enter æ¸²æŸ“
            inputEl.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    render();
                }
            });

            // åˆå§‹æ¸²æŸ“
            window.addEventListener('load', () => {
                if (window.MathJax && MathJax.typesetPromise) {
                    MathJax.typesetPromise([container]).catch(console.warn);
                }
            });

            // å…¨å±çŠ¶æ€å˜åŒ–ç›‘å¬ï¼ˆç”¨äºæ ·å¼å¾®è°ƒï¼‰
            container.addEventListener('fullscreenchange', () => {
                if (document.fullscreenElement === container) {
                    container.classList.add('fullscreen-active');
                } else {
                    container.classList.remove('fullscreen-active');
                }
            });

        })();
    </script>
</body>
</html>